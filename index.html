<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muslim Assistant - Ammar Ali</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #27ae60;
            --delete-color: #e74c3c;
            --bg-color: #f4f7f6;
            --text-color: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: 0.3s;
            min-height: 100vh;
        }

        /* Sidebar Navigation Fixes for Android */
        #sidebar {
            width: 260px;
            height: 100vh; 
            height: 100dvh; /* Modern mobile height fix */
            background: var(--primary-color);
            color: white;
            position: fixed;
            left: 0;
            top: 0;
            transition: 0.3s;
            display: flex;
            flex-direction: column;
            z-index: 1001;
            box-shadow: 2px 0 5px rgba(0,0,0,0.2);
            overflow-y: auto; /* Allows scrolling if menu is long */
            -webkit-overflow-scrolling: touch;
        }

        #sidebar.closed {
            left: -260px;
        }

        .sidebar-header {
            padding: 20px;
            font-size: 1.5em;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: sticky;
            top: 0;
            background: var(--primary-color);
        }

        .close-btn {
            cursor: pointer;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            padding: 5px;
        }

        .nav-menu {
            flex-grow: 1;
            padding-top: 10px;
        }

        .nav-item {
            padding: 18px 25px; /* Slightly larger for touch */
            cursor: pointer;
            transition: 0.2s;
            display: block;
            text-decoration: none;
            color: white;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .nav-item:hover {
            background: var(--accent-color);
        }

        .made-by {
            padding: 20px;
            font-size: 0.85em;
            border-top: 1px solid rgba(255,255,255,0.1);
            text-align: center;
            font-style: italic;
            background: var(--primary-color);
        }

        /* Main Content */
        #main-content {
            flex-grow: 1;
            margin-left: 260px;
            padding: 20px;
            transition: 0.3s;
            min-height: 100vh;
            width: 100%;
        }

        #main-content.full-width {
            margin-left: 0;
        }

        .menu-open-btn {
            font-size: 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page {
            display: none;
            max-width: 800px;
            margin: 0 auto;
        }

        .page.active {
            display: block;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .islamic-date-display {
            font-size: 1.2em;
            color: var(--accent-color);
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Tasbeeh UI */
        .tasbeeh-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            direction: rtl;
        }

        .arabic-text {
            font-size: 1.4em;
            font-weight: bold;
            flex-grow: 1;
            text-align: right;
            margin-right: 15px;
        }

        .counter-controls {
            direction: ltr;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .namaz-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            margin-bottom: 8px;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .btn-delete {
            background: var(--delete-color);
            padding: 6px 12px;
            font-size: 0.8em;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-reset {
            background: #f39c12;
            margin-top: 15px;
            width: 100%;
            font-weight: bold;
            padding: 12px;
        }

        button {
            padding: 10px 15px;
            border-radius: 6px;
            border: none;
            background: var(--accent-color);
            color: white;
            cursor: pointer;
        }

        input[type="text"], input[type="number"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            width: calc(100% - 22px);
            margin-bottom: 10px;
        }

        .guide-section h3 {
            margin-top: 25px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            display: inline-block;
        }

        /* Mobile Specific Adjustment */
        @media (max-width: 768px) {
            #sidebar { 
                width: 280px; 
                left: -280px; 
            }
            #sidebar.open { 
                left: 0; 
            }
            #main-content { 
                margin-left: 0; 
            }
            .nav-item {
                padding: 20px 25px; /* Bigger tap area for Android */
            }
        }
    </style>
</head>
<body>

    <div id="sidebar" class="closed">
        <div class="sidebar-header">
            <span>Menu</span>
            <button class="close-btn" onclick="toggleSidebar()">‚úñ</button>
        </div>
        <div class="nav-menu">
            <div class="nav-item" onclick="showPage('home')">üè† Home</div>
            <div class="nav-item" onclick="showPage('tasbeeh')">üìø Tasbeeh</div>
            <div class="nav-item" onclick="showPage('namaz')">üïå Namaz Tracker</div>
            <div class="nav-item" onclick="showPage('azkar')">‚òÄÔ∏è Azkar</div>
            <div class="nav-item" onclick="showPage('settings')">‚öôÔ∏è Settings</div>
            <div class="nav-item" onclick="showPage('guide')">üìñ How to Use</div>
        </div>
        <div class="made-by">made by Ammar Ali</div>
    </div>

    <div id="main-content">
        <button class="menu-open-btn" onclick="toggleSidebar()">‚ò∞ Menu</button>

        <div id="home" class="page active">
            <h1>Welcome to Muslim Assistant</h1>
            <div class="card">
                <div id="hijri-date" class="islamic-date-display">Loading Islamic Date...</div>
                <h3>Daily Summary</h3>
                <p id="home-namaz-stat">Namaz Progress: 0 Completed</p>
                <p id="home-tasbeeh-stat">Recent Tasbeeh: None</p>
                <button class="btn-reset" onclick="resetProgress()">Reset Daily Progress</button>
            </div>
        </div>

        <div id="tasbeeh" class="page">
            <h2>Tasbeeh Counter</h2>
            <div class="card">
                <input type="text" id="t-name" placeholder="Name (e.g. SubhanAllah)">
                <input type="number" id="t-goal" placeholder="Goal (e.g. 100)">
                <button onclick="addNewTasbeeh()" style="width: 100%;">Add Tasbeeh</button>
            </div>
            <div id="tasbeeh-container"></div>
            
            <div id="active-counter" class="card" style="display:none; text-align: center;">
                <h2 id="active-arabic" class="arabic-text" style="text-align:center"></h2>
                <h1 id="count-display" style="font-size: 4em; margin: 20px 0;">0</h1>
                <p>Lap: <span id="lap-time">0</span>s</p>
                <button onclick="countUp()" style="padding: 30px; font-size: 1.8em; width: 100%; border-radius: 50px; background: var(--primary-color);">COUNT</button>
                <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: center;">
                    <button onclick="toggleAuto()">Auto Mode</button>
                    <button onclick="stopTasbeeh()" style="background:#7f8c8d;">Close</button>
                </div>
            </div>
        </div>

        <div id="namaz" class="page">
            <h2>Namaz Tracker</h2>
            <div id="namaz-container" class="card"></div>
            <div class="card">
                <h3>Add Extra Prayer</h3>
                <input type="text" id="extra-namaz-name" placeholder="e.g. Tahajjud">
                <button onclick="addExtraNamaz()" style="width: 100%;">Add</button>
            </div>
        </div>

        <div id="azkar" class="page">
            <h2>Azkar</h2>
            <div class="card">
                <input type="text" id="azkar-input" placeholder="Enter Azkar...">
                <button onclick="addAzkar()" style="width: 100%;">Add Azkar</button>
            </div>
            <div id="azkar-list"></div>
        </div>

        <div id="settings" class="page">
            <h2>Settings</h2>
            <div class="card">
                <label>Adhan Voice:</label>
                <select id="azan-voice" onchange="previewAdhan(this.value)" style="width: 100%; padding: 10px; margin-top: 5px;">
                    <option value="azan1.mp3">Adhan 1</option>
                    <option value="azan2.mp3">Adhan 2</option>
                    <option value="azan3.mp3">Adhan 3</option>
                </select>
                <br><br>
                <label>Theme Color:</label>
                <input type="color" id="theme-color" onchange="applyTheme(this.value)" style="width: 100%; height: 40px; border: none; padding: 0;">
            </div>
        </div>

        <div id="guide" class="page">
            <div class="card guide-section">
                <h2>üìñ How to Use</h2>
                <h3>üì± Navigation & Menu</h3>
                <p>Tap ‚ò∞ Menu to navigate. On Android, if the menu is long, you can scroll down inside the menu itself.</p>
                <h3>üìø Tasbeeh Counter</h3>
                <p>The "COUNT" button is extra large for easier tapping. Sound plays ONLY when the goal is reached.</p>
                <h3>üïå Namaz Tracker</h3>
                <p>Reset Button on Home clears ticks but keeps your prayer names.</p>
            </div>
        </div>
    </div>

    <script>
        let tasbeehs = [];
        let azkars = [];
        let prayers = [
            {id: 'fajr', name: 'Fajr', done: false, type: 'obligatory'},
            {id: 'dhuhr', name: 'Dhuhr', done: false, type: 'obligatory'},
            {id: 'asr', name: 'Asr', done: false, type: 'obligatory'},
            {id: 'maghrib', name: 'Maghrib', done: false, type: 'obligatory'},
            {id: 'isha', name: 'Isha', done: false, type: 'obligatory'}
        ];
        
        let activeTIndex = null;
        let count = 0;
        let autoInterval = null;
        let startTime = null;

        function updateIslamicDate() {
            const date = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const hijri = new Intl.DateTimeFormat('en-u-ca-islamic-uma-nu-latn', options).format(date);
            document.getElementById('hijri-date').innerText = hijri;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('closed');
            sidebar.classList.toggle('open');
            document.getElementById('main-content').classList.toggle('full-width');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            updateHomeStats();
            if(window.innerWidth <= 768) toggleSidebar();
        }

        function resetProgress() {
            if(confirm("Reset all counts and ticks for today?")) {
                prayers.forEach(p => p.done = false);
                tasbeehs.forEach(t => t.count = 0);
                renderNamaz();
                renderTasbeehs();
                updateHomeStats();
            }
        }

        function previewAdhan(fileName) {
            const audio = new Audio(fileName);
            audio.play().catch(e => console.log("Sound file not found"));
            setTimeout(() => { audio.pause(); audio.currentTime = 0; }, 5000);
        }

        function addNewTasbeeh() {
            const name = document.getElementById('t-name').value;
            const goal = parseInt(document.getElementById('t-goal').value) || 0;
            if(!name) return;
            tasbeehs.push({ name, goal, count: 0 });
            document.getElementById('t-name').value = '';
            document.getElementById('t-goal').value = '';
            renderTasbeehs();
        }

        function deleteTasbeeh(index, event) {
            event.stopPropagation();
            tasbeehs.splice(index, 1);
            renderTasbeehs();
        }

        function renderTasbeehs() {
            const container = document.getElementById('tasbeeh-container');
            container.innerHTML = '';
            tasbeehs.forEach((t, index) => {
                container.innerHTML += `
                    <div class="tasbeeh-row card" onclick="openCounter(${index})">
                        <button class="btn-delete" onclick="deleteTasbeeh(${index}, event)">Delete</button>
                        <div class="counter-controls">
                            <span>${t.count} / ${t.goal}</span>
                        </div>
                        <span class="arabic-text">${t.name}</span>
                    </div>
                `;
            });
        }

        function openCounter(index) {
            activeTIndex = index;
            count = tasbeehs[index].count;
            document.getElementById('tasbeeh-container').style.display = 'none';
            document.getElementById('active-counter').style.display = 'block';
            document.getElementById('active-arabic').innerText = tasbeehs[index].name;
            document.getElementById('count-display').innerText = count;
            startTime = Date.now();
        }

        function countUp() {
            count++;
            let now = Date.now();
            document.getElementById('lap-time').innerText = ((now - startTime) / 1000).toFixed(2);
            startTime = now;
            document.getElementById('count-display').innerText = count;
            
            if(count === parseInt(tasbeehs[activeTIndex].goal)) {
                new Audio('alert.mp3').play().catch(() => alert("Goal Reached!"));
                if(autoInterval) toggleAuto();
            }
        }

        function toggleAuto() {
            if(autoInterval) { clearInterval(autoInterval); autoInterval = null; }
            else { autoInterval = setInterval(countUp, 2000); }
        }

        function stopTasbeeh() {
            tasbeehs[activeTIndex].count = count;
            clearInterval(autoInterval);
            document.getElementById('tasbeeh-container').style.display = 'block';
            document.getElementById('active-counter').style.display = 'none';
            renderTasbeehs();
        }

        function renderNamaz() {
            const container = document.getElementById('namaz-container');
            container.innerHTML = '';
            prayers.forEach((p, index) => {
                container.innerHTML += `
                    <div class="namaz-item">
                        <span>${p.name}</span>
                        <div>
                            <input type="checkbox" ${p.done ? 'checked' : ''} onchange="toggleNamaz(${index})" style="width:20px; height:20px;">
                            ${p.type === 'nafl' ? `<button class="btn-delete" onclick="deleteNamaz(${index})">√ó</button>` : ''}
                        </div>
                    </div>
                `;
            });
        }

        function deleteNamaz(index) { prayers.splice(index, 1); renderNamaz(); }
        function toggleNamaz(index) { prayers[index].done = !prayers[index].done; updateHomeStats(); }
        function addExtraNamaz() {
            const name = document.getElementById('extra-namaz-name').value;
            if(name) { prayers.push({ id: Date.now(), name, done: false, type: 'nafl' }); renderNamaz(); }
        }

        function addAzkar() {
            const val = document.getElementById('azkar-input').value;
            if(val) { azkars.push(val); document.getElementById('azkar-input').value = ''; renderAzkars(); }
        }

        function deleteAzkar(index) { azkars.splice(index, 1); renderAzkars(); }

        function renderAzkars() {
            const list = document.getElementById('azkar-list');
            list.innerHTML = '';
            azkars.forEach((a, index) => {
                list.innerHTML += `<div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                    <span>${a}</span>
                    <button class="btn-delete" onclick="deleteAzkar(${index})">Delete</button>
                </div>`;
            });
        }

        function applyTheme(color) { document.documentElement.style.setProperty('--primary-color', color); }

        function updateHomeStats() {
            const done = prayers.filter(p => p.done).length;
            document.getElementById('home-namaz-stat').innerText = `Namaz Progress: ${done} Completed`;
        }

        updateIslamicDate();
        renderNamaz();
    </script>
</body>
</html>
